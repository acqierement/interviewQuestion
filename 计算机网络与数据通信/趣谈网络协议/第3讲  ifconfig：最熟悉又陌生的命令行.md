# 第3讲 | ifconfig：最熟悉又陌生的命令行

## ifconfig和ip addr

在Linux上，可能大家都知道用ifconfig查看IP地址，但是很多人可能不知道ip addr这个命令（比如我）。这两个命令其实和net-tools 和 iproute2有关。如果你的Linux上面没有ifconfig和ip addr命令，那这个时候你就需要自行安装 net-tools 和 iproute2这两个工具。现在很多新的linux发行版中最小化安装中已经没有net-tools（比如redhat系列发行版7x)，这样我们熟悉的ifconfig命令就无法使用了，要使用ip命令替代。

### net-tools

如今许多系统管理员仍结合使用ifconfig、route、arp和netstat等命令行工具（它们统称为net-tools），管理和排查各种网络配置。这类工具原先起源于BSD TCP/IP工具箱，旨在配置老式Linux内核的网络功能。自2001年以后，它在Linux社区的发展就止步不前了。Arch Linux和CentOS/RHEL 7等一些Linux发行版已经弃用了net-tools，其他发行版计划弃用net-tools，改而使用iproute2。

### iproute2

iproute2是另一个系列的网络配置工具，它旨在取代net-tools的功能。net-tools可以通过procfs（/proc）和ioctl系统调用，访问和更改内核网络配置，iproute2则通过网络链路套接字接口与内核进行联系。/proc接口比网络链路接口来得更笨拙。抛开性能不讲，iproute2的用户界面比net-tools的用户界面要来得直观。比如说，网络资源（比如链路、IP地址、路由和隧道等）用“对象”抽象进行了恰当的定义，你可以使用一致的语法来管理不同的对象。最重要的是，迄今为止iproute2一直在积极开发当中。

他们的用法上有很大的区别，前面提到的ifconfig和ip addr就是查看IP地址各自的命令，其他的还有：

```shell
激活或禁止网络接口
使用net-tools
$ sudo ifconfig eth1 up  
$ sudo ifconfig eth1 down 

使用route2
$ sudo ip link set down eth1  
$ sudo ip link set up eth1 
```

```shell

```

## IP地址

IP地址可以看我写的另一篇文章。

### IPv4

IPv4地址是一个32位的二进制，分成四组，每组8位，每组范围0~255。比如192.168.3.5。IP地址可以划分成网络地址和主机地址。前半部分是网络地址，后半部分是主机地址。至于从哪里开始划分则要看是哪一类的IP地址了。

IP地址分为ABCD四类，A类以0开头，B类以10开头，c类以110开头，每一类规定了网络地址和主机地址的划分

![](H:\Adata\gitHubWorkspace\interviewQuestion\计算机网络与数据通信\趣谈网络协议\图片\IP地址分类.png)

### IPv6

IPv6地址长这样：FEDC:BA98:7654:3210:FEDC:BA98:7654:3210。一共有128位，用冒号分隔：有8组，每组有四个16进制的数，一个16进制的数要用4个二进制，四个十六进制有16位，16*8就是总共128位。

但是我们看到的IP地址可能是这样的fe80::d452:d382:df77:d94e，这里有两个冒号，其实就是中间都是0，所以可以选择省略，不过双冒号在一个地址中只能使用一次。

### 无类型域间选路（CIDR）

按类别进行分类已经将网络地址和主机地址的位数定死了，就那么四类。没有那么灵活，所以需要CIDR来自定义网络地址和主机地址的位数。10.100.122.2/24 后面的/24就代表网络地址有24位，那么主机地址就是8位了。

如果没有后面的/24,还可以用子网掩码，前面这个IP地址的子网掩码就是255.255.255.0，网络地址置1，主机地址置0。这样只需通过子网掩码就可以知道网络地址和主机地址的位数了。然后还有一个广播地址，就是主机地址全部置1的地址：10.100.122.255。如果发送这个地址，所有 10.100.122 网络里面的机器都可以收到。

### 公有 IP 地址和私有 IP 地址

尽管CIDR的划分很灵活，基本上都是使用这种方式。但是分类的IP地址还划分了各自的私有IP地址，私有IP地址就是可以由自己自由分配的IP，比如我的学校和你的学校，可以使用相同的私有地址，私有IP地址范围内，学校可以随便分配。但是对于公有IP地址，有个组织统一分配，需要购买，这个IP地址全世界可以访问。

## MAC 地址

MAC地址长这样：fa:16:3e:c7:79:75 可以看到每个数字都是16进制数，所以每个数字有4位二进制，每组两个数字就有8位，一共6组，总共就是48位。

MAC 地址号称全局唯一，不会有两个网卡有相同的MAC 地址，而且网卡自生产出来，就带着这个地址。那可能就会想，既然MAC地址已经是唯一的了，为什么不用MAC地址直接通信呢？还需要IP地址。

因为MAC地址没有规律，只是一个唯一的标识。而IP地址你可以根据网络地址知道该往哪里走，直到到达一个子网，你就可以用上MAC地址了。

MAC 地址的通信范围比较小，局限在一个子网里面。例如，从 192.168.0.2/24 访问192.168.0.3/24 是可以用 MAC 地址的。一旦跨子网，即从 192.168.0.2/24 到 192.168.1.2/24，MAC地址就不行了，需要 IP 地址起作用了。

## 网络设备的状态标识

我们查看linux中的IP地址时，可能会看到这样的信息。

```
eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
```

<BROADCAST,MULTICAST,UP,LOWER_UP>叫作net_device flags，网络设备的状态标识。

BROADCAST 表示这个网卡有广播地址，可以发送广播包；MULTICAST表示网卡可以发送多播包；UP 表示网卡处于启动的状态；LOWER_UP 表示 L1 是启动的，也即网线插着呢。

MTU1500 表示最大传输单元 MTU 为 1500，这是以太网的默认值。MTU 是二层 MAC 层的概念。MAC 层有 MAC 的头，以太网规定连 MAC 头带正文合起来，不允许超过 1500 个字节。正文里面有 IP 的头、TCP 的头、HTTP 的
头。如果放不下，就需要分片来传输。

qdisc pfifo_fast 是什么意思呢？qdisc 全称是queueing discipline，中文叫排队规则。内核如果需要通过某个网络接口发送数据包，它都需要按照为这个接口配置的 qdisc（排队规则）把数据包加入队列。

最简单的 qdisc 是 pfifo，它不对进入的数据包做任何的处理，数据包采用先入先出的方式通过队列。

pfifo_fast 稍微复杂一些，它的队列包括三个波段（band）。在每个波段里面，使用先进先出规则。三个波段（band）的优先级也不相同。band 0 的优先级最高，band 2 的最低。如果 band 0 里面有数据包，系统就不会处理 band 1 里面的数据包，band 1 和 band 2 之间也是一样。数据包是按照服务类型（Type of Service，TOS）被分配多三个波段（band）里面的。TOS 是 IP 头里面的一个字段，代表了当前的包是高优先级的，还是低优先级的。